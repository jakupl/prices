name: Generate mergedPriceList.json
on:
  push:
    paths:
      - 'mergePrices.mjs'
      - '.github/workflows/generate-merged-price.yml'
  schedule:
    - cron: '0 * * * *' # 

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Use Node
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install (if you have deps)
        run: |
          if [ -f package.json ]; then npm ci; fi

      - name: Run merge script (stdout -> mergedPriceList.json)
        # Jeśli mergePrices.mjs zapisuje plik sam — usuń przekierowanie > mergedPriceList.json
        run: node mergePrices.mjs > mergedPriceList.json

      - name: Commit generated file
        uses: EndBug/add-and-commit@v9
        with:
          author_name: github-actions
          author_email: github-actions@github.com
          message: "chore: update mergedPriceList.json (generated)"
          add: 'mergedPriceList.json'
